<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saajin Block â€“ Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .stat-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.8) 50%, rgba(255,255,255,0) 100%);
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .quick-link {
            transition: all 0.2s ease;
        }
        .quick-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navbar -->
    <nav class="bg-gradient-to-r from-blue-700 to-indigo-800 text-white p-4 shadow-lg">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i class="fas fa-cube text-2xl"></i>
                <h1 class="text-xl font-bold">Saajin Block | Admin Panel</h1>
            </div>
            <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg flex items-center space-x-2 transition duration-200">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto mt-8 px-4 pb-12">
        <!-- Welcome Section -->
        <div class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800">Welcome back, Admin!</h2>
            <p class="text-gray-600">Here's what's happening with your site today.</p>
        </div>

        <!-- Stats Section -->
        <div class="bg-white shadow rounded-xl p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-lg font-semibold text-gray-800">Dashboard Overview</h2>
                <button id="refreshStats" class="text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded-lg transition duration-200 flex items-center space-x-1">
                    <i class="fas fa-sync-alt"></i>
                    <span>Refresh</span>
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Articles Card -->
                <div class="stat-card bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-xl p-6 border border-indigo-100">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-medium text-indigo-700 mb-1">Total Articles</h3>
                            <p id="statArticles" class="text-4xl font-bold text-indigo-900 mt-2">0</p>
                        </div>
                        <div class="bg-indigo-200 p-3 rounded-lg">
                            <i class="fas fa-newspaper text-indigo-700 text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-indigo-600 flex items-center">
                        <i class="fas fa-arrow-up mr-1"></i>
                        <span>Updated just now</span>
                    </div>
                </div>

                <!-- Categories Card -->
                <div class="stat-card bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl p-6 border border-yellow-100">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-medium text-yellow-700 mb-1">Total Categories</h3>
                            <p id="statCategories" class="text-4xl font-bold text-yellow-900 mt-2">0</p>
                        </div>
                        <div class="bg-yellow-200 p-3 rounded-lg">
                            <i class="fas fa-folder text-yellow-700 text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-yellow-600 flex items-center">
                        <i class="fas fa-arrow-up mr-1"></i>
                        <span>Updated just now</span>
                    </div>
                </div>

                <!-- Comments Card -->
                <div class="stat-card bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-6 border border-green-100">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-medium text-green-700 mb-1">Total Comments</h3>
                            <p id="statComments" class="text-4xl font-bold text-green-900 mt-2">0</p>
                        </div>
                        <div class="bg-green-200 p-3 rounded-lg">
                            <i class="fas fa-comments text-green-700 text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 text-sm text-green-600 flex items-center">
                        <i class="fas fa-arrow-up mr-1"></i>
                        <span>Updated just now</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Access Section -->
        <div class="bg-white shadow rounded-xl p-6">
            <h2 class="text-lg font-semibold text-gray-800 mb-6">Quick Access</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                <a href="/saajin-admin/articles/" class="quick-link block p-5 bg-gradient-to-r from-indigo-500 to-indigo-600 rounded-lg text-white text-center font-medium">
                    <i class="fas fa-newspaper text-2xl mb-2"></i>
                    <div>Manage Articles</div>
                </a>
                <a href="/saajin-admin/categories/" class="quick-link block p-5 bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-lg text-white text-center font-medium">
                    <i class="fas fa-folder text-2xl mb-2"></i>
                    <div>Manage Categories</div>
                </a>
                <a href="/saajin-admin/comments/" class="quick-link block p-5 bg-gradient-to-r from-green-500 to-green-600 rounded-lg text-white text-center font-medium">
                    <i class="fas fa-comments text-2xl mb-2"></i>
                    <div>View Comments</div>
                </a>
            </div>
        </div>

        <!-- Recent Activity Section -->
        <div class="bg-white shadow rounded-xl p-6 mt-8">
            <h2 class="text-lg font-semibold text-gray-800 mb-6">Recent Activity</h2>
            <div class="space-y-4">
                <div class="flex items-start p-3 hover:bg-gray-50 rounded-lg">
                    <div class="bg-blue-100 p-2 rounded-full mr-3">
                        <i class="fas fa-file-alt text-blue-600"></i>
                    </div>
                    <div>
                        <p class="font-medium">New article published</p>
                        <p class="text-sm text-gray-500">2 hours ago</p>
                    </div>
                </div>
                <div class="flex items-start p-3 hover:bg-gray-50 rounded-lg">
                    <div class="bg-green-100 p-2 rounded-full mr-3">
                        <i class="fas fa-comment text-green-600"></i>
                    </div>
                    <div>
                        <p class="font-medium">New comment on "Getting Started"</p>
                        <p class="text-sm text-gray-500">5 hours ago</p>
                    </div>
                </div>
                <div class="flex items-start p-3 hover:bg-gray-50 rounded-lg">
                    <div class="bg-yellow-100 p-2 rounded-full mr-3">
                        <i class="fas fa-folder text-yellow-600"></i>
                    </div>
                    <div>
                        <p class="font-medium">Category "Tutorials" updated</p>
                        <p class="text-sm text-gray-500">Yesterday</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    /* LOGOUT */
    document.getElementById("logoutBtn").addEventListener("click", () => {
        localStorage.removeItem("access");
        localStorage.removeItem("refresh");
        window.location.href = "/saajin-admin/login/";
    });

    /* REFRESH STATS */
    document.getElementById("refreshStats").addEventListener("click", () => {
        const btn = document.getElementById("refreshStats");
        const originalContent = btn.innerHTML;
        btn.innerHTML = '<span class="loading"></span> Loading...';
        btn.disabled = true;

        loadStats().finally(() => {
            btn.innerHTML = originalContent;
            btn.disabled = false;
        });
    });

    /* Load API statistics */
    async function loadStats(){
        try {
            const articlesRes = await fetch('/api/articles/');
            const articlesData = await articlesRes.json();
            const catsRes = await fetch('/api/categories/');
            const catsData = await catsRes.json();
            const comsRes = await fetch('/api/comments/');
            const comsData = await comsRes.json();

            // Animate the counter
            animateValue("statArticles", 0, articlesData.count, 1000);
            animateValue("statCategories", 0, catsData.count, 1000);
            animateValue("statComments", 0, comsData.count, 1000);
        } catch(err){
            console.error("Unable to fetch stats", err);
            // Show error message
            document.getElementById("statArticles").innerText = "â€”";
            document.getElementById("statCategories").innerText = "â€”";
            document.getElementById("statComments").innerText = "â€”";
        }
    }

    /* Animate counter values */
    function animateValue(id, start, end, duration) {
        const obj = document.getElementById(id);
        const range = end - start;
        const minTimer = 50;
        let stepTime = Math.abs(Math.floor(duration / range));
        stepTime = Math.max(stepTime, minTimer);
        const startTime = new Date().getTime();
        const endTime = startTime + duration;
        let timer;

        function run() {
            const now = new Date().getTime();
            const remaining = Math.max((endTime - now) / duration, 0);
            const value = Math.round(end - (remaining * range));
            obj.innerHTML = value;
            if (value == end) {
                clearInterval(timer);
            }
        }

        timer = setInterval(run, stepTime);
        run();
    }

    /* init: */
    loadStats();
    </script>
</body>
</html>